Description: remove windows and osx from the build process
Author: Samuel MARTIN MORO <samuel@peerio.com>
Origin: vendor
Forwarded: not-needed
Last-Update: 2016-06-01
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/gulpfile.js	2016-06-01 20:31:38.833855055 +0200
+++ b/gulpfile.js	2016-06-02 20:11:42.417208101 +0200
@@ -18,15 +18,6 @@
 var localeDest = 'application/locale';
 var usedLangs = 'en,de,es,it,fr,ru,zh_CN,nb_NO,hu,tr,pt_BR,ja,cs';
 var buildDest = 'build/';
-var codesignCommands = ['Contents/MacOS/nwjs', 							// all executables must be signed
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Helper.app/',
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Helper.app/Contents/MacOS/nwjs\\ Helper',
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Framework.framework/Helpers/crashpad_handler',
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Framework.framework/libffmpeg.dylib',
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Framework.framework/libnode.dylib',
-			  'Contents/Versions/50.0.2661.94/nwjs\\ Framework.framework/nwjs\\ Framework',
-			  ''
-			  ];
 
 function getFileList(dir, filelist) {
   var files = fs.readdirSync(dir);
@@ -42,15 +33,6 @@
   return filelist;
 };
 
-codesignCommands = _.map(_.concat(getFileList(buildDest + 'Peerio/osx64/Peerio.app/Contents/Resources/app.nw'), _.map(codesignCommands, f => {
-	return  buildDest +'Peerio/osx64/Peerio.app/' + f;
-})), function(file) {
-  return 'codesign --force --verify --verbose --sign "' + process.env.PEERIO_DEVELOPER_ID + '" ' + file;
-});
-
-
-
-
 /**
  * Fetch json files from Transifex.
 **/
@@ -194,12 +176,6 @@
 });
 
 /**
- * Set permissions for Mac
- */
-gulp.task('finalize-mac-build', shell.task(['chmod -R 755 '+ buildDest +'Peerio/osx64/Peerio.app/']))
-// TODO zip
-
-/**
  * Zip the src directory, excluding node_modules.
  */
 gulp.task('finalize-win-build', function(callback) {
@@ -207,10 +183,8 @@
 			.pipe(gulp.dest(buildDest +'Peerio/win32/')); // TODO finalize linux build with this as well
 });
 
-// todo zip mac and windows binaries as well for Github & get md5 and sha1
-
 /**
- * Build the Mac, Windows, Linux & Chrome packages.
+ * Build the Linux & Chrome packages.
  */
 gulp.task('build', function(callback) {
 
@@ -221,30 +195,17 @@
    */
   var nw = new NwBuilder({
 		files: 'application/**/**', // use the glob format
-		platforms: ['win32','osx64'],
+		platforms: ['linux32','linux64'],
 		buildDir: buildDest,
 		appName: 'Peerio',
 		version: '0.14.4',
-		cacheDir: 'tmp/nw',
-		macIcns: 'application/img/nw.icns',
-		zip: false,
-		macPlist: {
-		  'UTTypeReferenceURL': 'https://peerio.com',
-		  'CFBundleIdentifier': 'com.peerio.peeriomac',
-		  'DTSDKBuild': buildNumber,
-		  	CFBundleDisplayName: "Peerio",
-		  	CFBundleName:"Peerio"
-		},
-		macPlistStrings: {
-			en: 'osx/plist_en.strings'
-		},
-		winIco: 'application/img/icon256.ico'				// comment this line if you don't have wine installed
+		cacheDir: 'tmp/nw'
 	});
 
 	runSequence('update-dependendencies', 'clean-build', function() {
 		nw.build()
 			.then(function() {
-				runSequence('finalize-mac-build', 'build-chrome', 'finalize-win-build', callback)
+				runSequence(callback)
 			})
 			.catch(function (error) {
 				console.error(error);
@@ -253,12 +214,6 @@
 	})
 });
 
-/**
- * Sign the Mac package.
- */
-gulp.task('sign', shell.task(codesignCommands))
-
-
 gulp.task('upload')
 
 /*
