# Build Process

The Mac, Windows and Linux versions of Peerio can be built using `nwjs` (formerly `node-webkit`). 

To build, install [node.js and npm](http://nodejs.org), as well as the [Transifex client](http://docs.transifex.com/client/setup/) with a `~/.transifexrc` file for user credentials. Within the root project directory, run `npm install`. Then, run `gulp build`. This command will generate working Mac, Windows and Linux builds. 

Mac and Linux users may want to comment out the `winIco` line in the `build` task in `gulpfile.js` (~ L207), since it is not useful to them and will require installing Wine.

## Mac

To run, simply double-click the package.

## Windows

Run Peerio.exe. `nw.pak` and other files generated by `nwjs` must be in the same directory as the executable. 

## Linux

### Generic

From the command line, run `./PATH/TO/EXECUTABLE/Peerio`.

`nw.pak` and other files generated by `nwjs` must be in the same directory as the executable. 

### Packages

Peerio-client is being packaged for several linux distros, you may be able to build your own package using one of the following

#### Debian/Ubuntu/Mint/Kali/Pearl

The easier way to go, is to rely on the docker configuration provided in the `pkg/debian` directory of this repository.

If you ever want to use the stuff in the `debian/` directory, keep in mind you will need the user generating your package to have his GPG signing key ready.

Using wheezy, you will need the backports repository.

#### ArchLinux/Manjaro

Download `pkg/archlinux/PKGBUILD` or `pkg/manjaro/PKGBUILD`, then run `makepkg`.

Assuming you have all build and runtime dependencies installed, this should produce a binary package in your working directory.

Note: there is known problems between libgl and virtualbox video driver, causing nw.js to open a blank window. Not sure how to fix yet. I have not seen this problem running my packages on physical hosts. You may still build your packages on virtual environments.

#### Gentoo

Create `/usr/local/portage/app-misc/peerio-client` on your filesystem - if not present already. Download `pkg/gentoo/peerio-client-${version}.ebuild` and file it in that directory.

If not configured already, make sure your system actually looks for ebuilds in `/usr/local/portage`, by adding the following to your `/etc/make.conf`
```
PORTDIR_OVERLAY="/usr/local/portage"
```

You may then install our client by running `emerge peerio-client`.

#### Fedora/CentOS/Mageia

If you are not familiar yet with the process of building packages, check out https://fedoraproject.org/wiki/How_to_create_an_RPM_package

Having run `rpmdev-setuptree`, you may download `pkg/fedora/peerio-client.spec`, `pkg/centos/peerio-client.spec` or `pkg/mageia/peerio-client.spec` into `~/rpmbuild/SPECS`.
Download the patches and sources as referrenced in your specfile, file them into `~/rpmbuild/SOURCES`.
You may now build your package, using `rpmbuild -ba ~/rpmbuild/SPECS/peerio-client.spec`.
CentOS users will need the `epel-release` repo installed, to satisfy all dependencies.

Assuming you have all build and runtime dependencies installed, this should produce a binary package in `~/rpmbuild/RPMS/`.

#### OpenSuSE

The process is pretty similar than with CentOS/Fedora/Mageia

Note that the last versions of libnss3 looks broken. The client will not be able to connect to our service. If you can, try downgrading your libnss to something like 3.19.

Main differences are there is no `rpmdev-setuptree`. Instead, you will be working in `/usr/src/packages/`. Copy the specfile from `pkg/opensuse/peerio-client.spec` into `/usr/src/packages/SPECS/`, download the patches and sources as referrenced in your specfile, file them into `/usr/src/packages/SOURCES`,  then run `rpmbuild -ba /usr/src/packages/SPECS/peerio-client.spec`.

#### PCLinuxOS

Again, the process is pretty similar than with CentOS/Fedora/Mageia/OpenSuSE

Main differences are there is no `rpmdev-setuptree`. Instead, you will be working in `~/src/rpm/`. Copy the specfile from `pkg/pclinuxos/peerio-client.spec` into `~/src/rpm/SPECS/`, download the patches and sources as referrenced in your specfile, file them into `~/src/rpm/SOURCES`,  then run `rpmbuild -ba ~/src/rpm/SPECS/peerio-client.spec`.

# Additional (Internal) Tooling

To bump the version number to a patch version, run `gulp bump`.

Before doing releases, make sure to run `gulp update` to update dependencies and translation copy. 

Mac OS code signing can be done with `gulp sign`, provided the right Developer ID certificate is installed and configured as an environment variable. 
